CREATE DATABASE DiscordLikeDB

CREATE TABLE Users(
Id INT PRIMARY KEY IDENTITY(1,1),
Name VARCHAR(30) NOT NULL,
Tag VARCHAR(35) NOT NULL UNIQUE,
Visibility VARCHAR(10) NOT NULL DEFAULT 'Online',
Subscription BIT NOT NULL DEFAULT 0,
Status VARCHAR(255)
)

CREATE TABLE Chats(
Id INT PRIMARY KEY IDENTITY(1,1),
CreatedOn DATETIME NOT NULL
)


CREATE TABLE USER_INTERACTIONS(
Id_User_One INT NOT NULL FOREIGN KEY REFERENCES Users(Id),
Id_User_Two INT NOT NULL FOREIGN KEY REFERENCES Users(Id),
Friend_Status VARCHAR(10),
Chat_Id INT FOREIGN KEY REFERENCES Chats(Id)

PRIMARY KEY(Id_User_One,Id_User_Two)	
)

CREATE TABLE Messages(
Id INT PRIMARY KEY IDENTITY(1,1),
Chat_Id INT NOT NULL FOREIGN KEY REFERENCES Chats(Id),
SendOn DATETIME DEFAULT GETDATE(),
SendBy INT NOT NULL FOREIGN KEY REFERENCES Users(Id),
Content VARCHAR(1000) NOT NULL,
IsPinned BIT NOT NULL DEFAULT 0,
)

CREATE TABLE Servers(
Id INT PRIMARY KEY IDENTITY(1,1),
Name VARCHAR(100) NOT NULL,
IsCommunity BIT NOT NULL DEFAULT 0,
Server_Boost_Level TINYINT NOT NULL DEFAULT 0,
Verification_Level VARCHAR(10) NOT NULL DEFAULT 'NONE'
)

CREATE TABLE Roles(
Id INT PRIMARY KEY IDENTITY(1,1),
Server_Id INT NOT NULL FOREIGN KEY REFERENCES Servers(Id),
Name VARCHAR(30) NOT NULL
)

CREATE TABLE Memberships(
Id_User INT NOT NULL FOREIGN KEY REFERENCES Users(Id),
Id_Server INT NOT NULL FOREIGN KEY REFERENCES Servers(Id),
Nickname VARCHAR(30),
RoleId INT NOT NULL REFERENCES Roles(Id)
PRIMARY KEY(Id_User,Id_Server)
)

CREATE TABLE Categories(
Id INT PRIMARY KEY IDENTITY(1,1),
Name VARCHAR(50) NOT NULL,
Server_Id INT NOT NULL FOREIGN KEY REFERENCES Servers(Id)
)

CREATE TABLE Text_Channels(
Id INT PRIMARY KEY IDENTITY(1,1),
Name VARCHAR(50) NOT NULL,
Category_Id INT NOT NULL FOREIGN KEY REFERENCES Categories(Id),
Slowmode INT NOT NULL DEFAULT 0,
Restricted BIT NOT NULL DEFAULT 0,
Chat_Id INT NOT NULL FOREIGN KEY REFERENCES Chats(Id)
)

CREATE TABLE Voice_Channels(
Id INT PRIMARY KEY IDENTITY(1,1),
Name VARCHAR(50) NOT NULL,
Category_Id INT NOT NULL FOREIGN KEY REFERENCES Categories(Id),
Bitrate TINYINT NOT NULL DEFAULT 64,
Video_Quality SMALLINT NOT NULL DEFAULT 720,
User_Limit TINYINT,
Restricted BIT NOT NULL DEFAULT 0,
Text_Channel_Id INT NOT NULL FOREIGN KEY REFERENCES Text_Channels(Id)
)

CREATE TABLE TEXT_ROLE_PERMISSION(
ROLE_ID INT FOREIGN KEY REFERENCES Roles(Id),
TEXT_ID INT FOREIGN KEY REFERENCES Text_Channels(Id)
PRIMARY KEY (ROLE_ID,TEXT_ID)
)
CREATE TABLE VOICE_ROLE_PERMISSION(
ROLE_ID INT FOREIGN KEY REFERENCES Roles(Id),
VOICE_ID INT FOREIGN KEY REFERENCES Voice_Channels(Id)
PRIMARY KEY (ROLE_ID,VOICE_ID)
)
CREATE TABLE CATEGORY_ROLE_PERMISSION(
ROLE_ID INT FOREIGN KEY REFERENCES Roles(Id),
CATEGORY_ID INT FOREIGN KEY REFERENCES Categories(Id)
PRIMARY KEY (ROLE_ID,CATEGORY_ID)
)
